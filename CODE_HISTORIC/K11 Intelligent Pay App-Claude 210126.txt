import React, { useState, useEffect, useRef } from 'react';
import { QrCode, Wallet, ShoppingCart, FileText, Home, Check, ArrowRight, ExternalLink, Smartphone, Store } from 'lucide-react';

export default function K11PaymentApp() {
  const [currentPage, setCurrentPage] = useState('home');
  const [walletConnected, setWalletConnected] = useState(false);
  const [walletAddress, setWalletAddress] = useState('');
  const [paymentAmount, setPaymentAmount] = useState('');
  const [qrCodeData, setQrCodeData] = useState('');
  const [transactionSuccess, setTransactionSuccess] = useState(false);
  const [acceptedTerms, setAcceptedTerms] = useState(false);
  const audioRef = useRef(null);

  // Simulate wallet connection
  const connectWallet = async () => {
    try {
      // In production, this would connect to Phantom wallet
      // if ('solana' in window) {
      //   const response = await window.solana.connect();
      //   setWalletAddress(response.publicKey.toString());
      //   setWalletConnected(true);
      // }
      
      // Simulated for demo
      const mockAddress = 'K11' + Math.random().toString(36).substring(2, 15).toUpperCase();
      setWalletAddress(mockAddress);
      setWalletConnected(true);
    } catch (err) {
      console.error('Wallet connection failed:', err);
    }
  };

  const generateQRCode = (amount) => {
    if (!amount) return;
    
    // Generate QR data (in production, this would be a Solana pay URL)
    const qrData = `solana:${walletAddress}?amount=${amount}&spl-token=K11&label=K11Payment`;
    setQrCodeData(qrData);
  };

  const processPayment = () => {
    // Simulate payment processing
    setTimeout(() => {
      setTransactionSuccess(true);
      
      // Play success sounds
      if (audioRef.current) {
        audioRef.current.play();
      }
      
      // Reset after 5 seconds
      setTimeout(() => {
        setTransactionSuccess(false);
        setPaymentAmount('');
        setQrCodeData('');
      }, 5000);
    }, 2000);
  };

  const renderHomePage = () => (
    <div className="space-y-8">
      <div className="text-center">
        <div className="inline-block bg-gradient-to-r from-purple-600 to-blue-600 p-4 rounded-full mb-4">
          <Wallet className="w-16 h-16 text-white" />
        </div>
        <h2 className="text-4xl font-bold text-gray-800 mb-4">K11 Intelligent Payment Service</h2>
        <p className="text-xl text-gray-600 mb-8">Fast, secure cryptocurrency payments on Solana</p>
      </div>

      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <button
          onClick={() => setCurrentPage('vendor')}
          className="bg-white p-8 rounded-xl shadow-lg hover:shadow-2xl transition-all transform hover:-translate-y-1 border-2 border-purple-200"
        >
          <Store className="w-16 h-16 text-purple-600 mb-4 mx-auto" />
          <h3 className="text-2xl font-bold text-gray-800 mb-2">Vendor Portal</h3>
          <p className="text-gray-600">Accept K11 payments with QR codes</p>
          <ArrowRight className="w-6 h-6 text-purple-600 mx-auto mt-4" />
        </button>

        <button
          onClick={() => setCurrentPage('purchaser')}
          className="bg-white p-8 rounded-xl shadow-lg hover:shadow-2xl transition-all transform hover:-translate-y-1 border-2 border-blue-200"
        >
          <Smartphone className="w-16 h-16 text-blue-600 mb-4 mx-auto" />
          <h3 className="text-2xl font-bold text-gray-800 mb-2">Purchaser Portal</h3>
          <p className="text-gray-600">Send K11 payments quickly & securely</p>
          <ArrowRight className="w-6 h-6 text-blue-600 mx-auto mt-4" />
        </button>
      </div>

      <div className="bg-gradient-to-r from-purple-600 to-blue-600 p-8 rounded-xl text-white">
        <h3 className="text-2xl font-bold mb-4">Purchase K11 Tokens</h3>
        <p className="mb-6">Get K11 tokens directly through our partners</p>
        <div className="flex flex-wrap gap-4">
          <button 
            onClick={() => window.open('https://phantom.app', '_blank')}
            className="bg-white text-purple-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors flex items-center gap-2"
          >
            <ExternalLink className="w-5 h-5" />
            Buy via Phantom
          </button>
          <button 
            onClick={() => window.open('https://www.orca.so', '_blank')}
            className="bg-white text-blue-600 px-6 py-3 rounded-lg font-semibold hover:bg-gray-100 transition-colors flex items-center gap-2"
          >
            <ExternalLink className="w-5 h-5" />
            Buy via Orca
          </button>
        </div>
      </div>

      <div className="text-center">
        <button
          onClick={() => setCurrentPage('terms')}
          className="text-blue-600 hover:text-blue-800 underline"
        >
          View Terms & Conditions
        </button>
      </div>
    </div>
  );

  const renderVendorPage = () => (
    <div className="space-y-6">
      <h2 className="text-3xl font-bold text-gray-800 flex items-center gap-3">
        <Store className="w-8 h-8 text-purple-600" />
        Vendor Portal
      </h2>

      {!walletConnected ? (
        <div className="bg-white p-8 rounded-xl shadow-lg text-center">
          <Wallet className="w-20 h-20 text-purple-600 mx-auto mb-4" />
          <h3 className="text-2xl font-bold mb-4">Connect Your Wallet</h3>
          <p className="text-gray-600 mb-6">Connect your Phantom wallet to start accepting payments</p>
          <button
            onClick={connectWallet}
            className="bg-purple-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-purple-700 transition-colors"
          >
            Connect Wallet
          </button>
        </div>
      ) : (
        <div className="space-y-6">
          <div className="bg-green-50 border-2 border-green-200 p-4 rounded-lg">
            <p className="text-green-800 font-semibold">âœ“ Wallet Connected: {walletAddress.substring(0, 20)}...</p>
          </div>

          <div className="bg-white p-6 rounded-xl shadow-lg">
            <h3 className="text-xl font-bold mb-4">Generate Payment QR Code</h3>
            <div className="space-y-4">
              <div>
                <label className="block text-sm font-semibold text-gray-700 mb-2">
                  Payment Amount (K11)
                </label>
                <input
                  type="number"
                  value={paymentAmount}
                  onChange={(e) => setPaymentAmount(e.target.value)}
                  className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                  placeholder="Enter amount"
                  step="0.01"
                />
              </div>
              <button
                onClick={() => generateQRCode(paymentAmount)}
                disabled={!paymentAmount}
                className="w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
              >
                Generate QR Code
              </button>
            </div>
          </div>

          {qrCodeData && (
            <div className="bg-white p-8 rounded-xl shadow-lg text-center">
              <h3 className="text-xl font-bold mb-4">Scan to Pay</h3>
              <div className="bg-gray-100 p-8 rounded-lg inline-block mb-4">
                <QrCode className="w-48 h-48 text-purple-600 mx-auto" />
                <p className="text-sm text-gray-600 mt-4">QR Code Generated</p>
                <p className="text-2xl font-bold text-purple-600 mt-2">{paymentAmount} K11</p>
              </div>
              <p className="text-gray-600">Have your customer scan this code with their K11 app</p>
            </div>
          )}
        </div>
      )}
    </div>
  );

  const renderPurchaserPage = () => (
    <div className="space-y-6">
      <h2 className="text-3xl font-bold text-gray-800 flex items-center gap-3">
        <Smartphone className="w-8 h-8 text-blue-600" />
        Purchaser Portal
      </h2>

      {!walletConnected ? (
        <div className="bg-white p-8 rounded-xl shadow-lg text-center">
          <Wallet className="w-20 h-20 text-blue-600 mx-auto mb-4" />
          <h3 className="text-2xl font-bold mb-4">Connect Your Wallet</h3>
          <p className="text-gray-600 mb-6">Connect your Phantom wallet to make payments</p>
          <button
            onClick={connectWallet}
            className="bg-blue-600 text-white px-8 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors"
          >
            Connect Wallet
          </button>
        </div>
      ) : (
        <div className="space-y-6">
          <div className="bg-green-50 border-2 border-green-200 p-4 rounded-lg">
            <p className="text-green-800 font-semibold">âœ“ Wallet Connected: {walletAddress.substring(0, 20)}...</p>
          </div>

          <div className="bg-white p-6 rounded-xl shadow-lg">
            <h3 className="text-xl font-bold mb-4">Scan Vendor QR Code</h3>
            <div className="bg-blue-50 border-2 border-dashed border-blue-300 p-12 rounded-lg text-center mb-4">
              <QrCode className="w-20 h-20 text-blue-600 mx-auto mb-4" />
              <p className="text-gray-600">Tap to scan QR code</p>
              <p className="text-sm text-gray-500 mt-2">(Camera access required)</p>
            </div>
            
            <div className="border-t-2 pt-4">
              <p className="text-sm text-gray-600 mb-3">Or enter payment details manually:</p>
              <input
                type="number"
                value={paymentAmount}
                onChange={(e) => setPaymentAmount(e.target.value)}
                className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent mb-3"
                placeholder="Amount (K11)"
                step="0.01"
              />
              <button
                onClick={processPayment}
                disabled={!paymentAmount}
                className="w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
              >
                Send Payment
              </button>
            </div>
          </div>

          <div className="bg-gradient-to-r from-purple-600 to-blue-600 p-6 rounded-xl text-white">
            <h3 className="text-lg font-bold mb-2">Need K11 Tokens?</h3>
            <p className="mb-4 text-sm">Purchase K11 directly from our partners</p>
            <div className="flex gap-3">
              <button 
                onClick={() => window.open('https://phantom.app', '_blank')}
                className="flex-1 bg-white text-purple-600 px-4 py-2 rounded-lg font-semibold hover:bg-gray-100 transition-colors text-sm"
              >
                Phantom
              </button>
              <button 
                onClick={() => window.open('https://www.orca.so', '_blank')}
                className="flex-1 bg-white text-blue-600 px-4 py-2 rounded-lg font-semibold hover:bg-gray-100 transition-colors text-sm"
              >
                Orca
              </button>
            </div>
          </div>
        </div>
      )}
    </div>
  );

  const renderTermsPage = () => (
    <div className="bg-white p-8 rounded-xl shadow-lg">
      <h2 className="text-3xl font-bold text-gray-800 mb-6 flex items-center gap-3">
        <FileText className="w-8 h-8 text-gray-600" />
        Terms & Conditions
      </h2>
      
      <div className="space-y-4 text-gray-700 max-h-96 overflow-y-auto pr-4">
        <section>
          <h3 className="text-xl font-bold mb-2">1. Acceptance of Terms</h3>
          <p>By using the K11 Intelligent Payment Service, you agree to be bound by these Terms and Conditions. If you do not agree to these terms, please do not use our service.</p>
        </section>

        <section>
          <h3 className="text-xl font-bold mb-2">2. Service Description</h3>
          <p>K11 Intelligent Payment Service facilitates cryptocurrency transactions using the K11 token on the Solana blockchain. The service provides QR code generation for vendors and payment processing for purchasers.</p>
        </section>

        <section>
          <h3 className="text-xl font-bold mb-2">3. Wallet Connection</h3>
          <p>Users must connect a compatible Solana wallet (such as Phantom) to use this service. You are responsible for maintaining the security of your wallet and private keys.</p>
        </section>

        <section>
          <h3 className="text-xl font-bold mb-2">4. Transaction Fees</h3>
          <p>All transactions on the Solana blockchain may incur network fees. K11 Intelligent Payment Service may charge additional service fees, which will be clearly disclosed before transaction confirmation.</p>
        </section>

        <section>
          <h3 className="text-xl font-bold mb-2">5. Security</h3>
          <p>While we implement industry-standard security measures, cryptocurrency transactions are irreversible. Users are responsible for verifying all transaction details before confirmation.</p>
        </section>

        <section>
          <h3 className="text-xl font-bold mb-2">6. Liability</h3>
          <p>K11 Intelligent Payment Service is provided "as is" without warranties. We are not liable for any losses resulting from the use of this service, including but not limited to transaction errors, network issues, or wallet compromises.</p>
        </section>

        <section>
          <h3 className="text-xl font-bold mb-2">7. Compliance</h3>
          <p>Users must comply with all applicable laws and regulations in their jurisdiction regarding cryptocurrency transactions and taxation.</p>
        </section>

        <section>
          <h3 className="text-xl font-bold mb-2">8. Changes to Terms</h3>
          <p>We reserve the right to modify these terms at any time. Continued use of the service constitutes acceptance of modified terms.</p>
        </section>
      </div>

      <div className="mt-6 flex items-start gap-3 bg-blue-50 p-4 rounded-lg">
        <input
          type="checkbox"
          id="acceptTerms"
          checked={acceptedTerms}
          onChange={(e) => setAcceptedTerms(e.target.checked)}
          className="mt-1 w-5 h-5"
        />
        <label htmlFor="acceptTerms" className="text-sm text-gray-700">
          I have read and agree to the Terms & Conditions
        </label>
      </div>
    </div>
  );

  const renderQRPage = () => (
    <div className="bg-white p-8 rounded-xl shadow-lg text-center">
      <h2 className="text-3xl font-bold text-gray-800 mb-6">QR Code Generator</h2>
      <div className="bg-gray-100 p-12 rounded-lg inline-block">
        <QrCode className="w-64 h-64 text-purple-600 mx-auto" />
      </div>
      <p className="text-gray-600 mt-6">Generate custom QR codes for K11 payments</p>
    </div>
  );

  return (
    <div className="min-h-screen bg-gradient-to-br from-purple-50 via-blue-50 to-indigo-100">
      {/* Hidden audio element for success sound */}
      <audio ref={audioRef}>
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBSuBzvLZizgJGGi77OWpTxELTqTg7bdjHQc7k9n0z3soBSh+zPLaizsKFGC37OyrUxQMSKHh8LpmIAU=" type="audio/wav" />
      </audio>

      {/* Success Animation Overlay */}
      {transactionSuccess && (
        <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
          <div className="bg-white p-12 rounded-2xl shadow-2xl text-center transform animate-bounce">
            <div className="bg-green-100 w-32 h-32 rounded-full flex items-center justify-center mx-auto mb-6">
              <Check className="w-20 h-20 text-green-600" />
            </div>
            <h3 className="text-3xl font-bold text-gray-800 mb-2">K11 Sent!</h3>
            <p className="text-xl text-gray-600 mb-4">Transaction Successful</p>
            <div className="text-4xl animate-spin">ðŸª™</div>
            <p className="text-gray-500 mt-4">Amount: {paymentAmount} K11</p>
          </div>
        </div>
      )}

      {/* Navigation */}
      <nav className="bg-white shadow-lg sticky top-0 z-40">
        <div className="max-w-6xl mx-auto px-6 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="bg-gradient-to-r from-purple-600 to-blue-600 p-2 rounded-lg">
                <Wallet className="w-8 h-8 text-white" />
              </div>
              <span className="text-2xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent">
                K11 Pay
              </span>
            </div>
            
            <div className="flex gap-2">
              <button
                onClick={() => setCurrentPage('home')}
                className={`px-4 py-2 rounded-lg font-semibold transition-colors ${
                  currentPage === 'home' ? 'bg-purple-600 text-white' : 'text-gray-600 hover:bg-gray-100'
                }`}
              >
                <Home className="w-5 h-5" />
              </button>
              <button
                onClick={() => setCurrentPage('vendor')}
                className={`px-4 py-2 rounded-lg font-semibold transition-colors ${
                  currentPage === 'vendor' ? 'bg-purple-600 text-white' : 'text-gray-600 hover:bg-gray-100'
                }`}
              >
                Vendor
              </button>
              <button
                onClick={() => setCurrentPage('purchaser')}
                className={`px-4 py-2 rounded-lg font-semibold transition-colors ${
                  currentPage === 'purchaser' ? 'bg-blue-600 text-white' : 'text-gray-600 hover:bg-gray-100'
                }`}
              >
                Purchaser
              </button>
              <button
                onClick={() => setCurrentPage('qr')}
                className={`px-4 py-2 rounded-lg font-semibold transition-colors ${
                  currentPage === 'qr' ? 'bg-indigo-600 text-white' : 'text-gray-600 hover:bg-gray-100'
                }`}
              >
                <QrCode className="w-5 h-5" />
              </button>
            </div>
          </div>
        </div>
      </nav>

      {/* Main Content */}
      <main className="max-w-6xl mx-auto px-6 py-8">
        {currentPage === 'home' && renderHomePage()}
        {currentPage === 'vendor' && renderVendorPage()}
        {currentPage === 'purchaser' && renderPurchaserPage()}
        {currentPage === 'terms' && renderTermsPage()}
        {currentPage === 'qr' && renderQRPage()}
      </main>

      {/* Footer */}
      <footer className="bg-white mt-12 py-6 border-t">
        <div className="max-w-6xl mx-auto px-6 text-center text-gray-600">
          <p className="mb-2">Â© 2026 K11 Intelligent Payment Service. Powered by Solana.</p>
          <button
            onClick={() => setCurrentPage('terms')}
            className="text-blue-600 hover:text-blue-800 underline text-sm"
          >
            Terms & Conditions
          </button>
        </div>
      </footer>
    </div>
  );
}